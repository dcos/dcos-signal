#/bin/bash
set -e

cleanup() {
  echo "Killing cosmos, PID: ${COSMOS}"
  kill -9 $COSMOS
  echo "Killing diagnostics, PID: ${DIAG}"
  kill -8 $DIAG
}
trap cleanup SIGINT SIGHUP 

IP=$1

echo "Forwarding localhost:1050 -> ${IP}:1050"
ssh -i ~/.ssh/mesos_dev.pem -N -L 1050:localhost:1050 core@$IP &
export DIAG=$!
echo "Diagnostics session PID ${DIAG}"

echo "Forwarding localhost:7070 -> ${IP}:7070"
ssh -i ~/.ssh/mesos_dev.pem  -N -L 7070:localhost:7070 core@$IP &
export COSMOS=$!
echo "Comsos session PID ${COSMOS}"

while :; do
  sleep 5
done
